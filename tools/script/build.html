<head>
    <script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
    
    <style>
        td.number {
            font-family: monospace;
            text-align: right;
            font-weight: bold;
        }
        td.failed {
            color: red;
            text-align: center;
        }
        tr.new_build_target {
            border-top: solid 2px black;
        }
        
        td.build_target, td.sketch {
            font-size: small;
        }
        
        .info {
            font-weight: bold;
        }
    </style>
</head>
<body>
    
    <hp>Compilation results for: <span class="info" id="core"></span></p>
    <p>Compiler version: <span class="info" id="compiler"></span></p>
    <p>
    Commit date: <span class="info" id="git_date"></span> (hash: <span class="info" id="git_hash"></span>)
    </p>
    
    <table cellpadding="1" cellspacing="1" border="1" style="border-collapse: collapse;">
        <thead>
            <th>Target</th>
            <th>Sketch</th>
            
            <th>Flash bytes</th>
            <th>RAM bytes</th>
            
            <th>Data</th>
            <th></th>
        </thead>
        <tbody id="result">
        </tbody>
    </table>
    
    <script>
        $.getJSON("build/latest.json", function(json) {
            var html = "";
            var prev_build_target = "";
            
            var results = json.results;
            
            $("#core").html(json.core);
            $("#compiler").html(json.compiler);
            $("#git_hash").html(json.git_hash);
            $("#git_date").html(json.git_date);
            
            for(build in results) {
                var split = build.split("|");
                
                var build_target = split[0];
                var hash = split[1];
                var sketch = split[2];
                var build_path = results[build]["build_path"];
                var result = results[build]["result"];
                
                build_target = build_target.replace("STM32GENERIC:STM32:", "")
                sketch = sketch.replace("STM32\\libraries\\", "");
                
                html += "<tr class=\"" + ((prev_build_target == build_target) ? "" : "new_build_target") + "\">";
                
                html += "<td class=\"build_target\">" + build_target + "</td>";
                html += "<td class=\"sketch\">" + sketch + "</td>";
                if (result[0]) {
                    html += "<td class=\"number\">" + Number(result[0]).toLocaleString('en') + "</td>";
                    html += "<td class=\"number\">" + Number(result[1]).toLocaleString('en') + "</td>";
                } else {
                    html += "<td class=\"failed number\" colspan=\"2\">FAILED</td>";
                }
                
                html += "</tr>";
                
                prev_build_target = build_target;
            }
            
            $("tbody#result").html(html);
        });
    </script>
</body>
